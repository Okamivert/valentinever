<!DOCTYPE html>
setInterval(() => spawnFloat(heartEmojis), 650);
setInterval(() => spawnFloat(lilyEmojis), 900);


// ===== BALLOONS =====
function spawnBalloon(){
const b = document.createElement('div');
b.className = 'balloon';
b.style.left = (Math.random() * 100) + 'vw';
b.style.animationDuration = (14 + Math.random() * 6) + 's';


const img = document.createElement('img');
img.src = balloonImages[balloonIdx % balloonImages.length];
img.alt = 'balloon photo';
balloonIdx++;


// Helpful debug if an image filename/path is wrong on GitHub Pages
img.onerror = () => console.log('Balloon image failed to load:', img.src);


b.appendChild(img);
document.body.appendChild(b);
setTimeout(() => b.remove(), 20000);
}


setInterval(spawnBalloon, 2500);


// ===== PAGE SWITCHING + MUSIC (segment loop 0:35 to 1:37) =====
const pageQuestion = document.getElementById('pageQuestion');
const pageYes = document.getElementById('pageYes');
const pageNo = document.getElementById('pageNo');
const bgm = document.getElementById('bgm');
const musicBtn = document.getElementById('musicBtn');


const START_TIME = 35; // 0:35
const END_TIME = 97; // 1:37


let segmentLoopArmed = false;


function armSegmentLoop(){
if (segmentLoopArmed) return;
segmentLoopArmed = true;


bgm.addEventListener('timeupdate', () => {
// Don't force-play here; just jump time. This prevents "late start"/stutters.
if (!bgm.paused && bgm.currentTime >= END_TIME) {
bgm.currentTime = START_TIME;
}
});
}


function playSegment(){
armSegmentLoop();


const startPlayback = () => {
// Seek first, then play only after seek completes
const onSeeked = () => {
bgm.removeEventListener('seeked', onSeeked);
bgm.play().then(() => {
musicBtn.textContent = 'ðŸ”‡ Stop Music';
}).catch(() => {});
};


bgm.addEventListener('seeked', onSeeked);
bgm.currentTime = START_TIME;
};


if (bgm.readyState >= 2) startPlayback();
else bgm.addEventListener('loadedmetadata', startPlayback, { once: true });
}


document.getElementById('yesBtn').onclick = () => {
playSegment();
pageQuestion.classList.add('hidden');
pageYes.classList.remove('hidden');
};


document.getElementById('noBtn').onclick = () => {
playSegment();
pageQuestion.classList.add('hidden');
pageNo.classList.remove('hidden');
};


musicBtn.onclick = () => {
if (bgm.paused) {
playSegment();
} else {
bgm.pause();
musicBtn.textContent = 'ðŸŽµ Play Music';
}
};


// ===== LIGHTWEIGHT SELF-TESTS (console) =====
(function runSelfTests(){
console.assert(!!pageQuestion && !!pageYes && !!pageNo, 'Missing one or more page containers');
console.assert(!!document.getElementById('yesBtn') && !!document.getElementById('noBtn'), 'Missing Yes/No buttons');
console.assert(!!bgm, 'Missing audio element');
const srcEl = bgm.querySelector('source');
console.assert(srcEl && srcEl.getAttribute('src') === 'song.mp3', 'Audio src should be song.mp3');
})();
</script>
</body>
</html>
